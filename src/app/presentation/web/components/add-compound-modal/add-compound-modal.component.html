<ion-modal [isOpen]="isOpen" (didDismiss)="close()" class="add-compound-modal">
    <ng-template>
        <div class="modal-wrapper">
            <!-- Header -->
            <div class="modal-header">
                <div class="header-icon-box">
                    <mat-icon>science</mat-icon>
                </div>
                <div class="header-text">
                    <h2>Agregar Compuesto</h2>
                    <p>Busca en la base de datos química</p>
                </div>
                <button class="close-btn" (click)="close()">
                    <mat-icon>close</mat-icon>
                </button>
            </div>

            <!-- Content -->
            <div class="modal-body">
                <!-- Search Bar -->
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <mat-icon class="s-icon">search</mat-icon>
                        <input type="text" [(ngModel)]="searchQuery" (keyup.enter)="onSearch()"
                            placeholder="Buscar por nombre (ej. Mentol, Quercetina...)" [disabled]="isLoading">
                        <button class="btn-search" (click)="onSearch()" [disabled]="isLoading || !searchQuery">
                            <span *ngIf="!isLoading">Buscar</span>
                            <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
                        </button>
                    </div>
                </div>

                <!-- Results -->
                <div class="results-container">
                    <!-- Loading State -->
                    <div *ngIf="isLoading" class="state-container">
                        <ion-spinner name="bubbles"></ion-spinner>
                        <p>Analizando bases de datos...</p>
                    </div>

                    <!-- Initial State -->
                    <div *ngIf="!hasSearched && !isLoading" class="state-container">
                        <mat-icon class="big-icon">travel_explore</mat-icon>
                        <p>Ingresa el nombre de un compuesto para comenzar la búsqueda</p>
                    </div>

                    <!-- No Results -->
                    <div *ngIf="hasSearched && !isLoading && searchResults.length === 0" class="state-container">
                        <mat-icon class="big-icon">search_off</mat-icon>
                        <p>No se encontraron resultados para "{{ searchQuery }}"</p>
                    </div>

                    <!-- Results List -->
                    <div *ngIf="hasSearched && !isLoading && searchResults.length > 0" class="results-grid">
                        <div *ngFor="let res of searchResults" class="result-card" [class.selected]="isSelected(res)"
                            (click)="onSelect(res)">
                            <div class="card-header">
                                <span class="cid-badge">CID: {{ res.pubchemCid }}</span>
                                <mat-icon *ngIf="isSelected(res)" class="check">check_circle</mat-icon>
                            </div>
                            <h3>{{ res.name }}</h3>
                            <p class="iupac">{{ res.iupacName }}</p>
                            <div class="formula-box">
                                <span class="label">Fórmula:</span>
                                <span class="value">{{ res.molecularFormula }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="modal-footer">
                <button class="btn-text" (click)="close()">Cancelar</button>
                <button class="btn-confirm" [disabled]="selectedCompounds.length === 0" (click)="onConfirm()">
                    Agregar {{ selectedCompounds.length }} Compuestos <mat-icon>arrow_forward</mat-icon>
                </button>
            </div>
        </div>
    </ng-template>
</ion-modal>