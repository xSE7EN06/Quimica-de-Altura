<div class="compounds-page">
    <header class="compounds-header">
        <div class="page-title">
            <h1>Gestión de Compuestos Químicos</h1>
            <p>Administración de fitocompuestos y moléculas aisladas</p>
        </div>
    </header>

    <app-data-table [data]="compounds" [columns]="columns" [loading]="tableLoading" (rowClick)="onViewCompound($event)"
        (editAction)="onEditCompound($event)" (deleteAction)="onBulkDelete($event)" (resetFilters)="onResetFilters()">

        <div search-bar class="search-bar">
            <mat-icon class="search-icon">search</mat-icon>
            <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearch($event)" placeholder="Buscar compuestos..." />
            <mat-icon class="clear-icon" *ngIf="searchTerm" (click)="searchTerm = ''; onSearch('')">close</mat-icon>
        </div>

        <button add-button class="btn-primary" (click)="onAddCompound()">
            <mat-icon>science</mat-icon> Alta de Compuesto
        </button>

        <!-- Dynamic Filter Menu -->
        <div filter-menu class="filter-controls-vertical">
            <div class="filter-group">
                <label>Propiedades</label>
                <select [ngModel]="selectedProperty" (ngModelChange)="onFilterChange('property', $event)">
                    <option value="">Agregar propiedad...</option>
                    <option *ngFor="let prop of getAvailableProperties()" [value]="prop">{{ prop }}</option>
                </select>

                <!-- Active Filters Display -->
                <div class="active-filters" *ngIf="activeFilters.property.length > 0">
                    <div class="filter-label">Filtros activos:</div>
                    <div class="filter-chips">
                        <span *ngFor="let prop of activeFilters.property" class="filter-chip">
                            {{ prop }}
                            <mat-icon (click)="removePropertyFilter(prop)">close</mat-icon>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </app-data-table>

    <!-- Modals -->
    <app-add-compound-modal (compoundsAdded)="onCompoundsAdded($event)"></app-add-compound-modal>
    <app-compound-modal [compound]="selectedCompound" [hasPrevious]="hasPrevious" [hasNext]="hasNext"
        (prev)="onPrevCompound()" (next)="onNextCompound()" (saved)="onSaveCompound($event)">
    </app-compound-modal>

    <app-confirmation-modal title="Eliminar Registro"
        message="¿Estás seguro de que deseas eliminar este registro del repositorio? Esta acción no se puede deshacer."
        confirmText="Eliminar" confirmColor="#E53E3E" (confirmed)="onConfirmDelete()">
    </app-confirmation-modal>

    <!-- Templates -->
    <ng-template #nameTpl let-item>
        <div class="compound-name-cell">
            <div class="icon-thumb">
                <mat-icon>flask</mat-icon>
            </div>
            <div class="info">
                <span class="main-name">{{ item.name }}</span>
                <span class="sub-iupac">{{ item.iupacName }}</span>
            </div>
        </div>
    </ng-template>

    <ng-template #formulaTpl let-item>
        <code class="formula-tag">{{ item.molecularFormula }}</code>
    </ng-template>

    <ng-template #propertiesTpl let-item>
        <div class="properties-container">
            <span *ngFor="let prop of item.properties"
                  class="property-tag"
                  [class.active]="isPropertyFiltered(prop)"
                  (click)="onPropertyTagClick($event, prop)">
                {{ prop }}
            </span>
        </div>
    </ng-template>
</div>